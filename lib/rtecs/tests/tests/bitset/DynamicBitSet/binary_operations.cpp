#include "rtecs/bitset/DynamicBitSet.hpp"

#include <gtest/gtest.h>

#include "logger/Logger.h"

using namespace rtecs::bitset;

TEST(DynamicBitSet, and_operation)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000000 },
        }
    };
    const DynamicBitSet res = set1 & set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000000"
    );
};

TEST(DynamicBitSet, and_operation_with_lower_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet res = set1 & set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000000"
    );
};

TEST(DynamicBitSet, and_operation_with_bigger_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
        }
    };
    const DynamicBitSet res = set1 & set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000000"
    );
};

TEST(DynamicBitSet, and_equal_operation)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000101 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000100 },
        }
    };
    res &= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000100"
    );
};

TEST(DynamicBitSet, and_equal_operation_with_lower_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000100 },
        }
    };
    res &= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000000"
    );
};

TEST(DynamicBitSet, and_equal_operation_with_bigger_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000100 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000001 },
        }
    };
    res &= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000000"
    );
};

TEST(DynamicBitSet, or_operation)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet res = set1 | set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, or_operation_with_lower_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet res = set1 | set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, or_operation_with_bigger_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet res = set1 | set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, or_equal_operation)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    res |= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, or_equal_operation_with_lower_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    res |= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, or_equal_operation_with_bigger_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    res |= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000011 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, xor_operation)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet res = set1 ^ set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000001"
    );
};

TEST(DynamicBitSet, xor_operation_with_lower_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet res = set1 ^ set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, xor_operation_with_bigger_size)
{
    const DynamicBitSet set1{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet res = set1 ^ set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000011"
    );
};

TEST(DynamicBitSet, xor_equal_operation)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    res ^= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000001"
    );
};

TEST(DynamicBitSet, xor_equal_operation_with_lower_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    res ^= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000010"
    );
};

TEST(DynamicBitSet, xor_equal_operation_with_bigger_size)
{
    DynamicBitSet res{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    const DynamicBitSet set2{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
        }
    };
    res ^= set2;

    ASSERT_STREQ(
        res.toString(" ").c_str(),
        "0000000000000000000000000000000000000000000000000000000000000001 0000000000000000000000000000000000000000000000000000000000000010"
    );
};

TEST(DynamicBitSet, not_operation)
{
    const DynamicBitSet set{
        {
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000010 },
            std::bitset<64>{ 0b0000000000000000000000000000000000000000000000000000000000000011 },
        }
    };
    const DynamicBitSet inverse = ~set;

    ASSERT_STREQ(
        inverse.toString(" ").c_str(),
        "1111111111111111111111111111111111111111111111111111111111111101 1111111111111111111111111111111111111111111111111111111111111100"
    );
};
